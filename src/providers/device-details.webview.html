<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/vscode-webview-ui-toolkit/1.2.2/toolkit.min.js" integrity="sha512-GQVvN7HpO/vv/HL/BmDpahCaQu+Sh8HrvLrXO8fZGhNtSzluO421GIbN1Kix5a81V4VAm4GIeLPRPBgLmPsF4Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style type="text/css">
      .details-section {
        margin-bottom: 10px
      }
    </style>
  </head>
  <body>
    <div class="device-selected" style="display: none">
      <p><span id="serial-number"></span></p>
      <section class="details-section">
        <vscode-button appearance="primary" id="connect-button">Connect</vscode-button>
        <vscode-button appearance="primary" id="disconnect-button">Disconnect</vscode-button>
      </section>
      <vscode-divider role="separator"></vscode-divider>
      <h3>Options</h3>
      <section class="details-section">
        <vscode-text-field type="text" id="baud-rate">Baud Rate</vscode-text-field>
      </section>
      <section class="details-section">
        <vscode-text-field type="text" id="custom-name">Custom Name</vscode-text-field>
      </section>
      <section class="details-section">
        <vscode-button appearance="secondary" id="save-button">Save</vscode-button>
      </section>
    </div>
    <script>
      const serialNumber = document.getElementById('serial-number')
      const baudRate = document.getElementById('baud-rate')
      const customName = document.getElementById('custom-name')

      const vscode = acquireVsCodeApi()
      let currentDevice = null
      let connected = false

      document.getElementById('save-button').addEventListener('click', () => {
        vscode.postMessage({
          command: 'save',
          baudRate: baudRate.value,
          name: customName.value
        })
      })

      document.getElementById('connect-button').addEventListener('click', () => {
        vscode.postMessage({ command: 'connect' })
      })

      document.getElementById('disconnect-button').addEventListener('click', () => {
        vscode.postMessage({ command: 'disconnect' })
      })

      const handledConnected = () => {
        if (connected) {
          document.getElementById('connect-button').style.display = 'none'
          document.getElementById('disconnect-button').style.display = 'inline-block'
        } else {
          document.getElementById('connect-button').style.display = 'inline-block'
          document.getElementById('disconnect-button').style.display = 'none'
        }
      }

      // Handle the message inside the webview
      window.addEventListener('message', event => {
        const message = event.data; // The JSON data our extension sent
        switch (message.command) {
          case 'setSelected':
            if (message.device) {
              currentDevice = message.device
              serialNumber.textContent = message.device.serialNumber
              baudRate.value = message.device.baudRate
              connected = message.device.connected || false
              customName.value = message.device.name
              baudRate.value = message.device.baudRate
              handledConnected()
              document.querySelector('.device-selected').style.display = 'inline-block'
            } else {
              serialNumber.textContent = 'None'
              baudRate.value = ''
              connected = false
              handledConnected()
              document.querySelector('.device-selected').style.display = 'none'
            }
            break;
          case 'connected':
            // hide the connect button
            connected = message.device.connected
            handledConnected()
            break;
          case 'disconnected':
            // hide the connect button
            connected = message.device.connected
            handledConnected()
            break;

        }
      });
    </script>
  </body>
</html>
